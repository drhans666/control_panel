{% extends "panel/base.html" %}
{% load bootstrap3 %}

{% block header %}
    <h2>Assign to section</h2>
{% endblock header %}

{% block content %}
<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>

    <script type="text/javascript">
    function formatItem (item) {
        if (item.loading) return item.text;

        var markup = '<div class="clearfix">' +
        '<div class="col-sm-1">' +
        '<div clas="col-sm-10">' +
        '<div class="clearfix">' +
        '<div class="col-sm-6">' + item.name + '</div>' +
        '</div>';

        markup += '</div></div>';

        return markup;
      }

      function formatItemSelection (item) {
        return item.name || item.text;
      }


    $(document).ready(function () {
        $("#item_select").select2({
            tokenSeparators: [',', ' '],
            minimumInputLength: 1,
            minimumResultsForSearch: 5,
            ajax: {
                url: '/rest/items/',
                dataType: "json",
                type: "GET",
                data: function (params) {

                    var queryParameters = {
                        search: params.term
                    }
                    return queryParameters;
                },
                processResults: function (data, params) {
                      params.page = params.page || 1;

                      return {
                        results: data.items,
                        pagination: {
                          more: (params.page * 30) < data.total_count
                        }
                      };
                    },
                    cache: true
                  },
                  escapeMarkup: function (markup) { return markup; }, // let our custom formatter work
                  minimumInputLength: 1,
                  templateResult: formatItem,
                  templateSelection: formatItemSelection
                });
                });
    </script>
</head>

<form action="{% url 'inventory:add_to_section' %}" method="post" enctype="multipart/form-data">
    <div class="row">
        <div class="col-sm-4">
            {% csrf_token %}
            <div class="form-group">
                <label>Item name:</label>
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-glass"></i></span>
                    <select class="form-control" id="item_select">
                        <option class="map" value="3620194" selected="selected">Choose Item</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-sm-1">
            <div class="form-group">
                <label>Quantity:</label>
            {% bootstrap_field form.quantity %}
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-sm-4">
            <div class="form-group">
                <label>Section:</label>
                <div class="input-group">
                    <span class="input-group-addon"><i class="glyphicon glyphicon-equalizer"></i></span>
                    {% bootstrap_field form.section %}
                </div>
                <a href="{% url 'inventory:new_section'%}">add section</a>
            </div>
            {% buttons %}
            <button name="submit" class="btn btn-primary">Allocate</button>
            {% endbuttons %}
        </div>
    </div>
</form>

        {% if messages %}
        <ul class="messages">
            {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
            {% endfor %}
        </ul>
        {% endif %}
{% endblock content %}
